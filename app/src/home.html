<!DOCTYPE html>
<html>
  <head>
    <title>首页</title>
  </head>
    <script src="https://unpkg.com/antd@3.9.3/dist/antd.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.18.2/antd.compact.min.css">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.18.2/antd.min.js"></script>
  <style>
    input {
      display: block;
      margin-bottom: 12px;
    }
    img {
    height: 200px;
    width: 200px;
    }
    
    li {
    list-style: none;
    }

    a {
        color: black !important;
        text-decoration: none;
        margin-bottom: 20px;
    }

    .headnav {
        margin-bottom: -25px;
        width: 100%;
        height: 60px;
        /* background-color: #e6f7ff; */
    }

    .headnav li {
        float: left;
        padding-left: 15px;
        padding-right: 15px;
        margin-left: 10px;
        height: 60px;
        line-height: 60px;
        text-align: center;
        max-height: 60px;
        /* background-color: brown; */
        color: black;
        transition: .3s;
    }

    .headnav li:hover  {
        color: #65b5ff !important;
        cursor: pointer;
    }

    .headnav li:last-of-type {
        float: right;
        margin-right: 50px;
    }

    .headnav li:nth-of-type(7) {
        margin-left: -70px;
        float: right;
    }

    .headnav li:nth-of-type(7):hover a {
        color: red !important;
    }

    .headnav #search {
        padding-top: 15px;
    }

    .current {
        border-bottom: 2px solid #65b5ff;
        color: #65b5ff !important;
    }
    .current a{
      color: #65b5ff !important;
    }

    .all{
      width: 90%;
      margin-left: 5%;
    }
  </style>
  <body>
    <div id="root"></div>

    <script src="//cdn.jsdelivr.net/npm/pouchdb@7.3.0/dist/pouchdb.min.js"></script>
    <script src="pouchdbFind.js"></script>
    <script src="index.js"></script>
    <script type="text/babel">
      const {Input,Divider,message,Button,Form,Modal} = antd;
      const { Search } = Input;
      
      class SearchInput extends React.Component{
        onSearch = (value) => nftModel.search(value);
        render(){
          return (
            <>
            <Search
            placeholder="在此输入要查询的nft名字"
            allowClear
            onSearch={this.onSearch}
            style={{
              width: 200,
            }}
    />
            </>
            )
        }
      }
      class Headnav extends React.Component {
        state={status:'home'}
        home=()=>this.setState({status:'home'})
        activity=()=>this.setState({status:'activity'})
        mynft=()=>this.setState({status:'mynft'})
        notify=()=>this.setState({status:'notify'})
        personmessage=()=>this.setState({status:'personmessage'})
        render() {
          return (
            <>
              <ul className="headnav">
                <li className="current"><a href="http://localhost:8081/home.html"  onClick={this.home}>首页</a></li>
                <li><h1>GDUT-NFT</h1></li>
                <li id="search"><SearchInput/></li>
                <li onClick={this.activity}>活动</li>
                <li  onClick={this.mynft} className='create'>铸造我的nft</li>
                <li  onClick={this.notify}>公告</li>
                <li><a href="http://localhost:8081/index.html" onClick={accountModel.logout}>注销</a></li>
                <li  onClick={this.personmessage}>个人信息</li>
              </ul>
              <Divider/>
              <div className="all">
                <Content  status={this.state.status} create={this.state.create}/>
              </div>
            </>
          )
        }
      }
      class Content extends React.Component {
        render() {
          switch(this.props.status){
            case 'home': return <Home/>
            case 'activity':return <Activity/>
            case 'mynft':return <Mynft/>
            case 'notify':return <Notify/>
            case 'personmessage':return <PersonMessage/>
          }
        }
      }
      class Home extends React.Component{
        previous=()=>{
          var page = document.getElementById("page").innerText;
        if(document.getElementById("page").innerText > 1){
          var amount = null;
          document.getElementById("page").innerText--;
          for(let i = 0;i < 4;i++){
            amount = document.getElementById("activityNFTAmount"+i).innerText;
            pageModel.indexId -= new Number(amount);
            console.log(pageModel.indexId);
          }
          pageModel.indexId--;
          pageModel.showAllNFT();
          var amount = pageModel.getMaxHomePage().then(res=>{
          var maxPage = (res % 4 == 0)?(res / 4):(Math.ceil(res / 4));   
          if(new Number(page) == maxPage){
            for(let i = 0;i < 4;i++){
              var nftShow = document.getElementById("nft"+i);
                nftShow.style.display="block";
            } 
          }
        });
        } else {
          message.info('first page!',1);
        }
        }
        next=()=>{
          var amount = pageModel.getMaxHomePage().then(res=>{
          var maxPage = (res % 4 == 0)?(res / 4):(Math.ceil(res / 4));   
          var page = document.getElementById("page").innerText;
          if(new Number(page)< maxPage){
            document.getElementById("page").innerText++;
            pageModel.showAllNFT();
          } else {
            message.info('final page',1);
          }
        });
        }
        render(){
          return (
            <>
            <label style={{fontSize:'20px'}}>当前链上nft：</label>
            <div style={{overflow:'hidden'}}>
              <div id="nft0" style={{float:'left',marginLeft:'80px'}}>
              <img id="num0"/>
              <span id="name0"></span><br/>
              <span id="tokenId0"></span><br/>
              <span id="author0"></span><br/>
              <span id="description0"></span>
              <span id="activityNFTAmount0" hidden></span>
            </div>
              <div id="nft1" style={{float:'left',marginLeft:'80px'}}>
              <img id="num1"/><br/>
              <span id="name1"></span><br/>
              <span id="tokenId1"></span><br/>
              <span id="author1"></span><br/>
              <span id="description1"></span>
              <span id="activityNFTAmount1" hidden></span>
            </div>
              <div id="nft2" style={{float:'left',marginLeft:'80px'}}>
              <img id="num2"/><br/>
              <span id="name2"></span><br/>
              <span id="tokenId2"></span><br/>
              <span id="author2"></span><br/>
              <span id="description2"></span>
              <span id="activityNFTAmount2" hidden></span>
            </div>
              <div id="nft3" style={{float:'left',marginLeft:'80px'}}>
              <img id="num3"/><br/>
              <span id="name3"></span><br/>
              <span id="tokenId3"></span><br/>
              <span id="author3"></span><br/>
              <span id="description3"></span>
              <span id="activityNFTAmount3" hidden></span>
              </div>
            </div>
            <div style={{textAlign:'center' ,marginTop:'40px'}}>
              <Button type="dashed" onClick={this.previous} style={{marginRight:'10px'}}>上一页</Button>
              <Button type="dashed" onClick={this.next} style={{marginRight:'10px'}}>下一页</Button>
              第 <label id="page">1</label> 页
            </div>
            <div className="content"></div>
            </>
          )
        }
      }
      class Activity extends React.Component{
        state={isModalOpen:false}
        showModal = () => this.setState({isModalOpen:true});
        handleOk = () => this.setState({isModalOpen:false});
        handleCancel = () => this.setState({isModalOpen:false});
        onSearch=(value)=>activityModel.search(value);
        render(){
          return <div>
            <h1 style={{float:'left'}}>当前链上活动有：</h1>
            <div className="search" style={{float:'left',marginTop:'10px'}}>
              <Search
            placeholder="查询活动"
            allowClear
            onSearch={this.onSearch}
            style={{
              width: 150,
            }}
            />
              </div>
              <Modal title="创建活动" open={this.isModalOpen} onOk={this.handleOk} onCancel={this.handleCancel} visible={this.state.isModalOpen}>
                <span style={{width:'220px',height:'300px',backgroundColor:'red',display:'inline-block'}}>选文件</span>
                <span style={{width:'220px',height:'300px',backgroundColor:'green',display:'inline-block'}}>填表单</span>
            </Modal>
              <Button type='primary' style={{float:'right',marginTop:'10px'}} onClick={this.showModal}>我也要创建活动</Button>
            </div>
        }
      }
      class Mynft extends React.Component{
        preview=()=>pageModel.preview()
        onFinish=(values)=>{
          nftModel.create(values.name,values.des)
        };
        onFinishFailed = (errorInfo) => {
          console.log('Failed:', errorInfo);
        };
        render(){
          return <div>
            <h1>铸造我的nft</h1>        
            <div style={{display:'flex'}}>
              <div style={{marginRight:'150px'}}>
                <div><img id="nftShower"/></div>
                <p>上传一张图片，获得一份独一无二的nft</p>
                <input type="file" id="nft" onChange={this.preview}/>
              </div>
              <div>
                <Form
                style={{marginTop:'35px'}}
                  name="basic"
                  labelCol={{
                    span: 8,
                  }}
                  wrapperCol={{
                    span: 16,
                  }}
                  initialValues={{
                    remember: true,
                  }}
                  onFinish={this.onFinish}
                  onFinishFailed={this.onFinishFailed}
                  autoComplete="off"
                >
                  <Form.Item
                    label="名字 ："
                    name="name"
                    rules={[
                      {
                        required: true,
                        message: 'Please input your nftname!',
                      },
                    ]}
                  >
                    <Input style={{width:'220px'}}/>
                  </Form.Item>

                  <Form.Item
                  style={{marginTop:'35px'}}
                    label="描述 ："
                    name="des"
                    rules={[
                      {
                        required: true,
                        message: 'Please input your nftdescription!',
                      },
                    ]}
                  >
                    <Input style={{width:'220px'}}/>
                  </Form.Item>

                  <Form.Item
                    wrapperCol={{
                      offset: 8,
                      span: 16,
                    }}
                  >
                    <Button type="primary" htmlType="submit" style={{marginTop:'35px'}}>
                      确认铸造
                    </Button>
                  </Form.Item>
                </Form>
              </div>
            </div>
          </div>
        }
      }
      class Notify extends React.Component{
        render(){
          return <div><h1>Notify</h1></div>
        }
      }
      class PersonMessage extends React.Component{
        previous=()=>{
          var page = document.getElementById("page").innerText;
        if(document.getElementById("page").innerText > 1){
          document.getElementById("page").innerText--;
          pageModel.showMyNFT();
          pageModel.getMaxPersonalPage().then(res=>{
          var maxPage = (res % 4 == 0)?(res / 4):(Math.ceil(res / 4));   
          if(new Number(page) == maxPage){
            for(let i = 0;i < 4;i++){
              var nftShow = document.getElementById("nft"+i);
                nftShow.style.display="block";
            } 
          }
        });
        }else {
          message.info("已经是第一页了",.5)
        }
        }
        give=()=>nftModel.give()
        render(){
          return <div>
            <h1>我拥有的nft:</h1>
            <div style={{overflow:'hidden'}}>
              <div id="nft0" style={{float:'left',marginLeft:'80px',marginBottom:'20px'}}>
            <img id="num0"/>
            <span id='name0'></span>
            <span id="id0"></span><br/>
            <span id="description0"></span>
          </div>
              <div id="nft1" style={{float:'left',marginLeft:'80px',marginBottom:'20px'}}>
            <img id="num1"/>
            <span id='name1'></span>
            <span id="id1"></span>
            <span id="description1"></span>
          </div>
              <div id="nft2" style={{float:'left',marginLeft:'80px',marginBottom:'20px'}}>
            <img id="num2"/>
            <span id='name2'></span>
            <span id="id2"></span>
            <span id="description2"></span>
          </div>
              <div id="nft3" style={{float:'left',marginLeft:'80px',marginBottom:'20px'}}>
              <img id="num3"/>
              <span id='name3'></span>
              <span id="id3"></span>
              <span id="description3"></span>
            </div>
          </div>
            <div style={{textAlign:'center' ,marginTop:'40px'}}>
              <Button type="dashed" onClick={this.previous} style={{marginRight:'10px'}}>上一页</Button>
              <Button type="dashed" onClick={this.give} style={{marginRight:'10px'}}>转赠</Button>
              第 <label id="page">1</label> 页
            </div>
        </div>
        }
      }
      
      
      ReactDOM.render(
        <Headnav/>,
        document.getElementById("root")
      )
      const nav=document.querySelector('.headnav');
      for(let i=3;i<nav.children.length;i++){
          if(i==6)continue;
          nav.children[i].addEventListener('click',function(){
          for(let j=0;j<nav.children.length;j++){
            nav.children[j].className='';
          }
          this.className='current';
        })
        
      }
      
      </script>
  </body>
</html>